<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thi·∫øt k·∫ø ƒê·ªôi h√¨nh B√≥ng ƒë√° 11 ng∆∞·ªùi</title>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        :root {
            --primary-color: #1e88e5;
            --secondary-color: #0d47a1;
            --success-color: #43a047;
            --danger-color: #e53935;
            --light-color: #f5f5f5;
            --dark-color: #212121;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f0f2f5;
            color: var(--dark-color);
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .app-description {
            font-size: 1.1rem;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .main-content {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .formation-controls {
            flex: 1;
            min-width: 300px;
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .formation-selector {
            margin-bottom: 20px;
        }
        
        .formation-selector label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
        }
        
        .formation-selector select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }
        
        .player-form {
            background-color: var(--light-color);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }
        
        .btn {
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }
        
        .btn-primary:hover {
            background-color: var(--secondary-color);
        }
        
        .btn-danger {
            background-color: var(--danger-color);
            color: white;
        }
        
        .btn-danger:hover {
            background-color: #c62828;
        }
        
        .btn-success {
            background-color: var(--success-color);
            color: white;
        }
        
        .btn-success:hover {
            background-color: #2e7d32;
        }
        
        .player-list {
            margin-top: 20px;
        }
        
        .player-list h3 {
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #ddd;
        }
        
        .player-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            margin-bottom: 10px;
            background-color: var(--light-color);
            border-radius: 5px;
            border-left: 4px solid var(--primary-color);
        }
        
        .player-info {
            flex: 1;
        }
        
        .player-name {
            font-weight: 600;
        }
        
        .player-details {
            font-size: 0.9rem;
            color: #666;
        }
        
        .football-field-container {
            flex: 2;
            min-width: 500px;
            position: relative;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .football-field {
            width: 100%;
            height: 100%;
            min-height: 600px;
            background-color: #2e7d32;
            position: relative;
            overflow: hidden;
        }
        
        .field-image {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 0.7;
        }
        
        .field-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }
        
        .player-on-field {
            position: absolute;
            width: 70px;
            height: 70px;
            background-color: white;
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            cursor: move;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            transition: all 0.2s ease;
            z-index: 10;
            border: 2px solid #333;
            user-select: none;
            padding: 5px;
            text-align: center;
        }
        
        .player-on-field:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }
        
        .player-on-field.dragging {
            opacity: 0.8;
            z-index: 100;
        }
        
        .player-number {
            font-weight: bold;
            font-size: 1.1rem;
            line-height: 1;
        }
        
        .player-name-on-field {
            font-size: 0.65rem;
            font-weight: 600;
            margin-top: 2px;
            line-height: 1;
            max-width: 100%;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .player-position {
            font-size: 0.6rem;
            margin-top: 2px;
            line-height: 1;
            color: #666;
        }
        
        .team-name {
            text-align: center;
            color: white;
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 20px;
            background-color: rgba(0, 0, 0, 0.5);
            padding: 10px;
            border-radius: 5px;
        }
        
        .formation-preview {
            display: flex;
            justify-content: center;
            margin-top: 20px;
            color: white;
            font-weight: 600;
            background-color: rgba(0, 0, 0, 0.5);
            padding: 10px;
            border-radius: 5px;
        }
        
        .actions {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 20px;
        }
        
        .actions .btn {
            flex: 1;
            min-width: 120px;
        }
        
        .drag-instruction {
            text-align: center;
            margin-top: 10px;
            font-size: 0.9rem;
            color: #666;
        }
        
        .detected-formation {
            margin-top: 15px;
            padding: 10px;
            background-color: #e3f2fd;
            border-radius: 5px;
            border-left: 4px solid var(--primary-color);
        }
        
        .detected-formation h4 {
            margin-bottom: 5px;
            color: var(--secondary-color);
        }
        
        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
            
            .football-field-container {
                min-width: 100%;
            }
            
            .football-field {
                min-height: 500px;
            }
            
            .player-on-field {
                width: 60px;
                height: 60px;
            }
            
            .player-name-on-field {
                font-size: 0.6rem;
            }
            
            .actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Thi·∫øt k·∫ø ƒê·ªôi h√¨nh B√≥ng ƒë√°</h1>
            <p class="app-description">T·∫°o v√† t√πy ch·ªânh ƒë·ªôi h√¨nh b√≥ng ƒë√° 11 ng∆∞·ªùi c·ªßa b·∫°n. Th√™m c·∫ßu th·ªß, ch·ªânh s·ª≠a th√¥ng tin v√† s·∫Øp x·∫øp v·ªã tr√≠ tr√™n s√¢n.</p>
        </header>
        
        <div class="main-content">
            <div class="formation-controls">
                <div class="formation-selector">
                    <label for="formation">Ch·ªçn ƒë·ªôi h√¨nh:</label>
                    <select id="formation">
                        <option value="4-4-2">4-4-2 (C·ªï ƒëi·ªÉn)</option>
                        <option value="4-3-3">4-3-3 (T·∫•n c√¥ng)</option>
                        <option value="4-2-3-1">4-2-3-1 (Hi·ªán ƒë·∫°i)</option>
                        <option value="3-5-2">3-5-2 (Trung t√¢m)</option>
                        <option value="5-3-2">5-3-2 (Ph√≤ng ng·ª±)</option>
                        <option value="custom">T√πy ch·ªânh</option>
                    </select>
                </div>
                
                <div class="detected-formation">
                    <h4>ƒê·ªôi h√¨nh hi·ªán t·∫°i:</h4>
                    <div id="currentFormation">4-4-2</div>
                </div>
                
                <div class="player-form">
                    <h3>Th√™m c·∫ßu th·ªß m·ªõi</h3>
                    <div class="form-group">
                        <label for="playerName">T√™n c·∫ßu th·ªß:</label>
                        <input type="text" id="playerName" placeholder="Nh·∫≠p t√™n c·∫ßu th·ªß">
                    </div>
                    
                    <div class="form-group">
                        <label for="playerNumber">S·ªë √°o:</label>
                        <input type="number" id="playerNumber" min="1" max="99" placeholder="S·ªë √°o">
                    </div>
                    
                    <div class="form-group">
                        <label for="playerPosition">V·ªã tr√≠:</label>
                        <select id="playerPosition">
                            <option value="GK">Th·ªß m√¥n (GK)</option>
                            <option value="CB">Trung v·ªá (CB)</option>
                            <option value="LB">H·∫≠u v·ªá tr√°i (LB)</option>
                            <option value="RB">H·∫≠u v·ªá ph·∫£i (RB)</option>
                            <option value="CDM">Ti·ªÅn v·ªá ph√≤ng ng·ª± (CDM)</option>
                            <option value="CM">Ti·ªÅn v·ªá trung t√¢m (CM)</option>
                            <option value="LM">Ti·ªÅn v·ªá tr√°i (LM)</option>
                            <option value="RM">Ti·ªÅn v·ªá ph·∫£i (RM)</option>
                            <option value="CAM">Ti·ªÅn v·ªá t·∫•n c√¥ng (CAM)</option>
                            <option value="LW">Ti·ªÅn ƒë·∫°o c√°nh tr√°i (LW)</option>
                            <option value="RW">Ti·ªÅn ƒë·∫°o c√°nh ph·∫£i (RW)</option>
                            <option value="ST">Ti·ªÅn ƒë·∫°o trung t√¢m (ST)</option>
                        </select>
                    </div>
                    
                    <button id="addPlayer" class="btn btn-primary">Th√™m c·∫ßu th·ªß</button>
                </div>
                
                <div class="player-list">
                    <h3>Danh s√°ch c·∫ßu th·ªß</h3>
                    <div id="playersContainer">
                        <!-- Danh s√°ch c·∫ßu th·ªß s·∫Ω ƒë∆∞·ª£c th√™m v√†o ƒë√¢y b·∫±ng JavaScript -->
                    </div>
                </div>
                
                <div class="actions">
                    <button id="resetFormation" class="btn btn-danger">ƒê·∫∑t l·∫°i ƒë·ªôi h√¨nh</button>
                    <button id="saveFormation" class="btn btn-primary">L∆∞u ƒë·ªôi h√¨nh</button>
                    <button id="captureFormation" class="btn btn-success">Ch·ª•p ·∫£nh ƒë·ªôi h√¨nh</button>
                </div>
                
                <div class="drag-instruction">
                    <p>üí° <strong>H∆∞·ªõng d·∫´n:</strong> K√©o v√† th·∫£ c√°c c·∫ßu th·ªß tr√™n s√¢n ƒë·ªÉ thay ƒë·ªïi v·ªã tr√≠. ƒê·ªôi h√¨nh s·∫Ω t·ª± ƒë·ªông ƒë∆∞·ª£c nh·∫≠n di·ªán!</p>
                </div>
            </div>
            
            <div class="football-field-container">
                <div class="football-field" id="fieldToCapture">
                    <!-- H√¨nh ·∫£nh s√¢n b√≥ng ƒë√° -->
<img src="/Users/LENOVO/Pictures/Sanbong.png" alt="S√¢n b√≥ng ƒë√°" class="field-image">                    
                    <div class="team-name" id="teamName">ƒê·ªôi h√¨nh c·ªßa b·∫°n</div>
                    
                    <!-- C√°c c·∫ßu th·ªß s·∫Ω ƒë∆∞·ª£c th√™m v√†o ƒë√¢y b·∫±ng JavaScript -->
                    <div id="fieldPlayers"></div>
                    
                    <div class="formation-preview" id="formationPreview">ƒê·ªôi h√¨nh: 4-4-2</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // D·ªØ li·ªáu m·∫´u cho c·∫ßu th·ªß
        let players = [
            { id: 1, name: "Th·ªß m√¥n", number: 1, position: "GK", x: 5, y: 50 },
            { id: 2, name: "H·∫≠u v·ªá ph·∫£i", number: 2, position: "RB", x: 20, y: 20 },
            { id: 3, name: "Trung v·ªá 1", number: 3, position: "CB", x: 20, y: 40 },
            { id: 4, name: "Trung v·ªá 2", number: 4, position: "CB", x: 20, y: 60 },
            { id: 5, name: "H·∫≠u v·ªá tr√°i", number: 5, position: "LB", x: 20, y: 80 },
            { id: 6, name: "Ti·ªÅn v·ªá ph·∫£i", number: 6, position: "RM", x: 40, y: 20 },
            { id: 7, name: "Ti·ªÅn v·ªá trung t√¢m 1", number: 7, position: "CM", x: 40, y: 40 },
            { id: 8, name: "Ti·ªÅn v·ªá trung t√¢m 2", number: 8, position: "CM", x: 40, y: 60 },
            { id: 9, name: "Ti·ªÅn v·ªá tr√°i", number: 9, position: "LM", x: 40, y: 80 },
            { id: 10, name: "Ti·ªÅn ƒë·∫°o 1", number: 10, position: "ST", x: 70, y: 40 },
            { id: 11, name: "Ti·ªÅn ƒë·∫°o 2", number: 11, position: "ST", x: 70, y: 60 }
        ];

        let nextPlayerId = 12;
        let isDragging = false;
        let dragPlayer = null;
        let dragOffset = { x: 0, y: 0 };

        // C√°c v·ªã tr√≠ cho t·ª´ng ƒë·ªôi h√¨nh
        const formations = {
            "4-4-2": [
                { position: "GK", x: 5, y: 50 },
                { position: "RB", x: 20, y: 20 },
                { position: "CB", x: 20, y: 40 },
                { position: "CB", x: 20, y: 60 },
                { position: "LB", x: 20, y: 80 },
                { position: "RM", x: 40, y: 20 },
                { position: "CM", x: 40, y: 40 },
                { position: "CM", x: 40, y: 60 },
                { position: "LM", x: 40, y: 80 },
                { position: "ST", x: 70, y: 40 },
                { position: "ST", x: 70, y: 60 }
            ],
            "4-3-3": [
                { position: "GK", x: 5, y: 50 },
                { position: "RB", x: 20, y: 20 },
                { position: "CB", x: 20, y: 40 },
                { position: "CB", x: 20, y: 60 },
                { position: "LB", x: 20, y: 80 },
                { position: "CM", x: 40, y: 30 },
                { position: "CM", x: 40, y: 50 },
                { position: "CM", x: 40, y: 70 },
                { position: "RW", x: 70, y: 20 },
                { position: "ST", x: 70, y: 50 },
                { position: "LW", x: 70, y: 80 }
            ],
            "4-2-3-1": [
                { position: "GK", x: 5, y: 50 },
                { position: "RB", x: 20, y: 20 },
                { position: "CB", x: 20, y: 40 },
                { position: "CB", x: 20, y: 60 },
                { position: "LB", x: 20, y: 80 },
                { position: "CDM", x: 35, y: 40 },
                { position: "CDM", x: 35, y: 60 },
                { position: "RM", x: 50, y: 20 },
                { position: "CAM", x: 50, y: 50 },
                { position: "LM", x: 50, y: 80 },
                { position: "ST", x: 70, y: 50 }
            ],
            "3-5-2": [
                { position: "GK", x: 5, y: 50 },
                { position: "CB", x: 20, y: 30 },
                { position: "CB", x: 20, y: 50 },
                { position: "CB", x: 20, y: 70 },
                { position: "RM", x: 40, y: 20 },
                { position: "CM", x: 40, y: 40 },
                { position: "CM", x: 40, y: 50 },
                { position: "CM", x: 40, y: 60 },
                { position: "LM", x: 40, y: 80 },
                { position: "ST", x: 70, y: 40 },
                { position: "ST", x: 70, y: 60 }
            ],
            "5-3-2": [
                { position: "GK", x: 5, y: 50 },
                { position: "RB", x: 20, y: 20 },
                { position: "CB", x: 20, y: 35 },
                { position: "CB", x: 20, y: 50 },
                { position: "CB", x: 20, y: 65 },
                { position: "LB", x: 20, y: 80 },
                { position: "CM", x: 45, y: 35 },
                { position: "CM", x: 45, y: 50 },
                { position: "CM", x: 45, y: 65 },
                { position: "ST", x: 70, y: 40 },
                { position: "ST", x: 70, y: 60 }
            ]
        };

        // H√†m ƒë·ªÉ hi·ªÉn th·ªã c·∫ßu th·ªß tr√™n s√¢n
        function renderPlayersOnField() {
            const fieldPlayers = document.getElementById('fieldPlayers');
            fieldPlayers.innerHTML = '';
            
            players.forEach(player => {
                const playerElement = document.createElement('div');
                playerElement.className = 'player-on-field';
                playerElement.style.left = `${player.x}%`;
                playerElement.style.top = `${player.y}%`;
                playerElement.setAttribute('data-id', player.id);
                
                // R√∫t g·ªçn t√™n n·∫øu qu√° d√†i
                const displayName = player.name.length > 8 ? 
                    player.name.substring(0, 7) + '...' : player.name;
                
                playerElement.innerHTML = `
                    <div class="player-number">${player.number}</div>
                    <div class="player-name-on-field">${displayName}</div>
                    <div class="player-position">${getPositionName(player.position)}</div>
                `;
                
                // Th√™m s·ª± ki·ªán k√©o th·∫£
                playerElement.addEventListener('mousedown', startDrag);
                playerElement.addEventListener('touchstart', startDragTouch);
                
                fieldPlayers.appendChild(playerElement);
            });
            
            // T·ª± ƒë·ªông nh·∫≠n di·ªán ƒë·ªôi h√¨nh sau khi render
            detectFormation();
        }

        // H√†m ƒë·ªÉ hi·ªÉn th·ªã danh s√°ch c·∫ßu th·ªß
        function renderPlayerList() {
            const playersContainer = document.getElementById('playersContainer');
            playersContainer.innerHTML = '';
            
            players.forEach(player => {
                const playerItem = document.createElement('div');
                playerItem.className = 'player-item';
                
                playerItem.innerHTML = `
                    <div class="player-info">
                        <div class="player-name">${player.name} (#${player.number})</div>
                        <div class="player-details">V·ªã tr√≠: ${getPositionName(player.position)}</div>
                    </div>
                    <div>
                        <button class="btn btn-danger" onclick="removePlayer(${player.id})">X√≥a</button>
                    </div>
                `;
                
                playersContainer.appendChild(playerItem);
            });
        }

        // H√†m ƒë·ªÉ l·∫•y t√™n ƒë·∫ßy ƒë·ªß c·ªßa v·ªã tr√≠
        function getPositionName(positionCode) {
            const positions = {
                "GK": "TM",
                "CB": "TV",
                "LB": "HV Tr√°i",
                "RB": "HV Ph·∫£i",
                "CDM": "TVPN",
                "CM": "TVTT",
                "LM": "TV Tr√°i",
                "RM": "TV Ph·∫£i",
                "CAM": "TV T·∫•n c√¥ng",
                "LW": "TD Tr√°i",
                "RW": "TD Ph·∫£i",
                "ST": "TDTT"
            };
            
            return positions[positionCode] || positionCode;
        }

        // H√†m ƒë·ªÉ th√™m c·∫ßu th·ªß m·ªõi
        function addPlayer() {
            const name = document.getElementById('playerName').value.trim();
            const number = parseInt(document.getElementById('playerNumber').value);
            const position = document.getElementById('playerPosition').value;
            
            if (!name || isNaN(number)) {
                alert('Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin c·∫ßu th·ªß!');
                return;
            }
            
            // Ki·ªÉm tra xem s·ªë √°o ƒë√£ t·ªìn t·∫°i ch∆∞a
            if (players.some(player => player.number === number)) {
                alert('S·ªë √°o n√†y ƒë√£ ƒë∆∞·ª£c s·ª≠ d·ª•ng! Vui l√≤ng ch·ªçn s·ªë √°o kh√°c.');
                return;
            }
            
            // T√¨m v·ªã tr√≠ m·∫∑c ƒë·ªãnh cho c·∫ßu th·ªß d·ª±a tr√™n ƒë·ªôi h√¨nh hi·ªán t·∫°i
            const formation = document.getElementById('formation').value;
            const formationPositions = formations[formation];
            const defaultPosition = formationPositions ? formationPositions.find(pos => pos.position === position) : null;
            
            const newPlayer = {
                id: nextPlayerId++,
                name,
                number,
                position,
                x: defaultPosition ? defaultPosition.x : 50,
                y: defaultPosition ? defaultPosition.y : 50
            };
            
            players.push(newPlayer);
            renderPlayersOnField();
            renderPlayerList();
            
            // Reset form
            document.getElementById('playerName').value = '';
            document.getElementById('playerNumber').value = '';
        }

        // H√†m ƒë·ªÉ x√≥a c·∫ßu th·ªß
        function removePlayer(playerId) {
            players = players.filter(player => player.id !== playerId);
            renderPlayersOnField();
            renderPlayerList();
        }

        // H√†m ƒë·ªÉ thay ƒë·ªïi ƒë·ªôi h√¨nh
        function changeFormation() {
            const formation = document.getElementById('formation').value;
            
            if (formation === 'custom') {
                document.getElementById('formationPreview').textContent = `ƒê·ªôi h√¨nh: T√πy ch·ªânh`;
                document.getElementById('currentFormation').textContent = "T√πy ch·ªânh";
                return;
            }
            
            document.getElementById('formationPreview').textContent = `ƒê·ªôi h√¨nh: ${formation}`;
            document.getElementById('currentFormation').textContent = formation;
            
            // C·∫≠p nh·∫≠t v·ªã tr√≠ c·ªßa c√°c c·∫ßu th·ªß theo ƒë·ªôi h√¨nh m·ªõi
            const formationPositions = formations[formation];
            
            players.forEach(player => {
                const newPosition = formationPositions.find(pos => pos.position === player.position);
                if (newPosition) {
                    player.x = newPosition.x;
                    player.y = newPosition.y;
                }
            });
            
            renderPlayersOnField();
        }

        // H√†m ƒë·ªÉ ƒë·∫∑t l·∫°i ƒë·ªôi h√¨nh
        function resetFormation() {
            if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën ƒë·∫∑t l·∫°i to√†n b·ªô ƒë·ªôi h√¨nh? T·∫•t c·∫£ c·∫ßu th·ªß s·∫Ω b·ªã x√≥a.')) {
                players = [];
                nextPlayerId = 1;
                renderPlayersOnField();
                renderPlayerList();
            }
        }

        // H√†m ƒë·ªÉ l∆∞u ƒë·ªôi h√¨nh
        function saveFormation() {
            const teamName = prompt('Nh·∫≠p t√™n ƒë·ªôi b√≥ng:', 'ƒê·ªôi h√¨nh c·ªßa t√¥i');
            if (teamName) {
                document.getElementById('teamName').textContent = teamName;
                
                // Trong ·ª©ng d·ª•ng th·ª±c t·∫ø, b·∫°n c√≥ th·ªÉ l∆∞u d·ªØ li·ªáu v√†o localStorage ho·∫∑c g·ª≠i l√™n server
                const formationData = {
                    teamName,
                    formation: document.getElementById('currentFormation').textContent,
                    players
                };
                
                localStorage.setItem('savedFormation', JSON.stringify(formationData));
                alert('ƒê·ªôi h√¨nh ƒë√£ ƒë∆∞·ª£c l∆∞u!');
            }
        }

        // H√†m ƒë·ªÉ ch·ª•p ·∫£nh ƒë·ªôi h√¨nh
        function captureFormation() {
            const fieldElement = document.getElementById('fieldToCapture');
            
            html2canvas(fieldElement, {
                scale: 2, // TƒÉng ch·∫•t l∆∞·ª£ng ·∫£nh
                useCORS: true, // Cho ph√©p s·ª≠ d·ª•ng h√¨nh ·∫£nh t·ª´ ngu·ªìn kh√°c
                logging: false // T·∫Øt log ƒë·ªÉ tƒÉng hi·ªáu su·∫•t
            }).then(canvas => {
                // T·∫°o link t·∫£i ·∫£nh
                const link = document.createElement('a');
                link.download = 'doi-hinh-bong-da.png';
                link.href = canvas.toDataURL('image/png');
                link.click();
            }).catch(err => {
                console.error('L·ªói khi ch·ª•p ·∫£nh:', err);
                alert('C√≥ l·ªói x·∫£y ra khi ch·ª•p ·∫£nh ƒë·ªôi h√¨nh. Vui l√≤ng th·ª≠ l·∫°i!');
            });
        }

        // H√†m ƒë·ªÉ t·∫£i ƒë·ªôi h√¨nh ƒë√£ l∆∞u
        function loadSavedFormation() {
            const savedFormation = localStorage.getItem('savedFormation');
            if (savedFormation) {
                const formationData = JSON.parse(savedFormation);
                document.getElementById('teamName').textContent = formationData.teamName;
                document.getElementById('formation').value = "custom";
                players = formationData.players;
                nextPlayerId = Math.max(...players.map(p => p.id)) + 1;
                
                renderPlayersOnField();
                renderPlayerList();
                changeFormation();
            }
        }

        // H√†m nh·∫≠n di·ªán ƒë·ªôi h√¨nh d·ª±a tr√™n v·ªã tr√≠ c√°c c·∫ßu th·ªß
        function detectFormation() {
            if (players.length < 11) return;
            
            // Ph√¢n lo·∫°i c·∫ßu th·ªß theo v·ªã tr√≠ ngang (t·ªça ƒë·ªô x)
            const defenders = players.filter(p => p.x < 30 && p.position !== 'GK');
            const midfielders = players.filter(p => p.x >= 30 && p.x < 60 && p.position !== 'GK');
            const forwards = players.filter(p => p.x >= 60 && p.position !== 'GK');
            
            // ƒê·∫øm s·ªë l∆∞·ª£ng c·∫ßu th·ªß ·ªü m·ªói khu v·ª±c
            const defCount = defenders.length;
            const midCount = midfielders.length;
            const fwdCount = forwards.length;
            
            // X√°c ƒë·ªãnh ƒë·ªôi h√¨nh d·ª±a tr√™n s·ªë l∆∞·ª£ng
            let detectedFormation = "T√πy ch·ªânh";
            
            if (defCount === 4 && midCount === 4 && fwdCount === 2) {
                detectedFormation = "4-4-2";
            } else if (defCount === 4 && midCount === 3 && fwdCount === 3) {
                detectedFormation = "4-3-3";
            } else if (defCount === 4 && midCount === 5 && fwdCount === 1) {
                // Ki·ªÉm tra xem c√≥ 2 CDM kh√¥ng
                const cdms = midfielders.filter(p => p.position === 'CDM');
                if (cdms.length === 2) {
                    detectedFormation = "4-2-3-1";
                } else {
                    detectedFormation = "4-5-1";
                }
            } else if (defCount === 3 && midCount === 5 && fwdCount === 2) {
                detectedFormation = "3-5-2";
            } else if (defCount === 5 && midCount === 3 && fwdCount === 2) {
                detectedFormation = "5-3-2";
            } else if (defCount === 4 && midCount === 1 && fwdCount === 4) {
                detectedFormation = "4-1-4-1";
            } else if (defCount === 4 && midCount === 1 && fwdCount === 5) {
                // Ki·ªÉm tra xem c√≥ 4 ti·ªÅn v·ªá v√† 1 ti·ªÅn ƒë·∫°o kh√¥ng
                const attackingMids = midfielders.filter(p => 
                    p.position === 'CAM' || p.position === 'LM' || p.position === 'RM');
                if (attackingMids.length === 3 && fwdCount === 2) {
                    detectedFormation = "4-1-4-1";
                } else {
                    detectedFormation = "4-1-4-1";
                }
            } else if (defCount === 4 && midCount === 1 && fwdCount === 4) {
                detectedFormation = "4-1-4-1";
            }
            
            // C·∫≠p nh·∫≠t hi·ªÉn th·ªã ƒë·ªôi h√¨nh
            document.getElementById('currentFormation').textContent = detectedFormation;
            document.getElementById('formationPreview').textContent = `ƒê·ªôi h√¨nh: ${detectedFormation}`;
            
            // N·∫øu ƒë·ªôi h√¨nh ƒë∆∞·ª£c nh·∫≠n di·ªán, c·∫≠p nh·∫≠t dropdown
            if (detectedFormation !== "T√πy ch·ªânh") {
                document.getElementById('formation').value = detectedFormation;
            } else {
                document.getElementById('formation').value = "custom";
            }
        }

        // C√°c h√†m cho t√≠nh nƒÉng k√©o th·∫£
        function startDrag(e) {
            e.preventDefault();
            isDragging = true;
            dragPlayer = e.target.closest('.player-on-field');
            
            if (!dragPlayer) return;
            
            const playerId = parseInt(dragPlayer.getAttribute('data-id'));
            const player = players.find(p => p.id === playerId);
            
            const rect = dragPlayer.getBoundingClientRect();
            dragOffset.x = e.clientX - rect.left;
            dragOffset.y = e.clientY - rect.top;
            
            dragPlayer.classList.add('dragging');
            
            document.addEventListener('mousemove', drag);
            document.addEventListener('mouseup', stopDrag);
        }

        function startDragTouch(e) {
            e.preventDefault();
            isDragging = true;
            dragPlayer = e.target.closest('.player-on-field');
            
            if (!dragPlayer) return;
            
            const playerId = parseInt(dragPlayer.getAttribute('data-id'));
            const player = players.find(p => p.id === playerId);
            
            const touch = e.touches[0];
            const rect = dragPlayer.getBoundingClientRect();
            dragOffset.x = touch.clientX - rect.left;
            dragOffset.y = touch.clientY - rect.top;
            
            dragPlayer.classList.add('dragging');
            
            document.addEventListener('touchmove', dragTouch);
            document.addEventListener('touchend', stopDrag);
        }

        function drag(e) {
            if (!isDragging || !dragPlayer) return;
            
            const field = document.querySelector('.football-field');
            const fieldRect = field.getBoundingClientRect();
            
            let x = ((e.clientX - fieldRect.left - dragOffset.x) / fieldRect.width) * 100;
            let y = ((e.clientY - fieldRect.top - dragOffset.y) / fieldRect.height) * 100;
            
            // Gi·ªõi h·∫°n v·ªã tr√≠ trong s√¢n
            x = Math.max(2, Math.min(98, x));
            y = Math.max(2, Math.min(98, y));
            
            dragPlayer.style.left = `${x}%`;
            dragPlayer.style.top = `${y}%`;
            
            // C·∫≠p nh·∫≠t v·ªã tr√≠ trong d·ªØ li·ªáu
            const playerId = parseInt(dragPlayer.getAttribute('data-id'));
            const player = players.find(p => p.id === playerId);
            if (player) {
                player.x = x;
                player.y = y;
            }
            
            // Nh·∫≠n di·ªán ƒë·ªôi h√¨nh sau khi di chuy·ªÉn
            detectFormation();
        }

        function dragTouch(e) {
            if (!isDragging || !dragPlayer) return;
            
            const field = document.querySelector('.football-field');
            const fieldRect = field.getBoundingClientRect();
            const touch = e.touches[0];
            
            let x = ((touch.clientX - fieldRect.left - dragOffset.x) / fieldRect.width) * 100;
            let y = ((touch.clientY - fieldRect.top - dragOffset.y) / fieldRect.height) * 100;
            
            // Gi·ªõi h·∫°n v·ªã tr√≠ trong s√¢n
            x = Math.max(2, Math.min(98, x));
            y = Math.max(2, Math.min(98, y));
            
            dragPlayer.style.left = `${x}%`;
            dragPlayer.style.top = `${y}%`;
            
            // C·∫≠p nh·∫≠t v·ªã tr√≠ trong d·ªØ li·ªáu
            const playerId = parseInt(dragPlayer.getAttribute('data-id'));
            const player = players.find(p => p.id === playerId);
            if (player) {
                player.x = x;
                player.y = y;
            }
            
            // Nh·∫≠n di·ªán ƒë·ªôi h√¨nh sau khi di chuy·ªÉn
            detectFormation();
        }

        function stopDrag() {
            isDragging = false;
            if (dragPlayer) {
                dragPlayer.classList.remove('dragging');
                dragPlayer = null;
            }
            
            document.removeEventListener('mousemove', drag);
            document.removeEventListener('mouseup', stopDrag);
            document.removeEventListener('touchmove', dragTouch);
            document.removeEventListener('touchend', stopDrag);
        }

        // Kh·ªüi t·∫°o ·ª©ng d·ª•ng
        document.addEventListener('DOMContentLoaded', function() {
            // G√°n s·ª± ki·ªán
            document.getElementById('addPlayer').addEventListener('click', addPlayer);
            document.getElementById('formation').addEventListener('change', changeFormation);
            document.getElementById('resetFormation').addEventListener('click', resetFormation);
            document.getElementById('saveFormation').addEventListener('click', saveFormation);
            document.getElementById('captureFormation').addEventListener('click', captureFormation);
            
            // T·∫£i ƒë·ªôi h√¨nh ƒë√£ l∆∞u (n·∫øu c√≥)
            loadSavedFormation();
            
            // Hi·ªÉn th·ªã c·∫ßu th·ªß ban ƒë·∫ßu
            renderPlayersOnField();
            renderPlayerList();
        });
    </script>
</body>
</html>